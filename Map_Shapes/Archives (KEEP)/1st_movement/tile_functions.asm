;************************INCLUDE FILE*****************************
;(do not assemble stand-alone. For a stand-alone version of this routine see examples/rwts2)


;CALC.MAP.INDEX NOP
	
;THIS GOES IN THE DRIVER FOR NOW, LATER IN THE WORLD INIT ROUTINE	

;	LDX #$00
;	LDY #$00
	

;	LDA #GMAP.ROW0
;	STA GMAP.ADDRESS.INDEX
;	LDA /GMAP.ROW0
;	STA GMAP.ADDRESS.INDEX+$1
	
;	LDA #GMAP.ROW1
;	STA GMAP.ADDRESS.INDEX+$2
;	LDA /GMAP.ROW1
;	STA GMAP.ADDRESS.INDEX+$3
	
;	LDA #GMAP.ROW2
;	STA GMAP.ADDRESS.INDEX+$4
;	LDA /GMAP.ROW2
;	STA GMAP.ADDRESS.INDEX+$5




;==================================READ FROM HERE=======================

;the stuff above relates to my original idea on how to create a permenant index for the 
;GMAP.TILE.DATA array. I abandoned the idea for the one described below, but I'm keeping
;the original info around until I've got screen movement working at an acceptable speed. 


;**OPT** NOTE: I think an index can created. Not by the above method. Instead, in the world init routine, loop through the compressed
;map array and build an index of at least the row starting positions. store it in an array in the format 
;<uncompressed position>, <compressed index>.....so when doing the lookup routine, I can loop through the index array to find 
;the uncompressed position I'm looking for, and use the compressed index value to start the loop below at a much more
;advanced location. perhaps for the next row, the iteration in the index array can even pickup where it left off...sinc the next
;row by definition would be forward in the compressed map array, not backward.  
;
;I don't think I need to control the location in memory of the compressed tile data array, because it will be one big array.




;TESTED STATUS OF THIS VERSION: 16-BIT UPGRADE COMPLETE. 
;COMPLETE (/w 8-bit and 16-bit gmap.lookup value): LOAD ROW0 /w 4 scenario test, LOAD ROW1 with 4 scenario test. 
;
;the 4 scenarios are: 1) no overflow starting position, no overflow ending position, 2) overflow start, no overflow end 3) no overflow start, overflow end 4) overflow start, overflow end




TILE.LOOKUP.INDEX		;=============????============
;PARAMETERS: GMAP.LOOKUP(2)
;RETURN: GMAP.INDEX, GMAP.OVERFLOW (these are used by related routines such as TILE.LOOKUP.ROW, TILE.LOOKUP.SINGLE)

;WARNING: GMAP.LOOKUP is a 16-bit number. If using this routine via a driver with an 8 bit number make sure to init
;GMAP.LOOKUP+$1 to $00.

;init variables
	LDA #$00
	TAY
	STA GMAP.TALLY
	STA GMAP.TALLY+$1

	STA GMAP.INDEX.HO
	STA GMAP.INDEX.OVERFLOW
	
	LDA #GMAP.TILE.DATA
	STA GMAP.ADDRESS.INDEX
	LDA /GMAP.TILE.DATA
	STA GMAP.ADDRESS.INDEX+$1
	


;Identify the position in the compressed data associated with the uncompressed position lookup	
.LOOP.LOOKUP
	LDA (GMAP.ADDRESS.INDEX),Y				;**OPT** TO OPTIMIZE FOR SPEED, MAY BE ABLE TO SETUP A BRANCH SO THAT THE 16-BIT ADD IS ONLY DONE WHEN A 16-BIT VALUE IS PRESENT IN OP1 OR OP2. 
	STA OP1
	LDA GMAP.TALLY
	STA OP2
	
	LDA GMAP.TALLY+$1
	STA OP2+$1
	LDA #$00
	STA OP1+$1
	
	JSR ADC.16					;GMAP.TILE.DATA,X + GMAP.TALLY(2)

		
.TEMP2
	
	LDA RESULT
	STA GMAP.TALLY
	STA OP1
	LDA RESULT+$1
	STA GMAP.TALLY+$1
	STA OP1+$1
	
	
	LDA GMAP.LOOKUP
	STA OP2
	LDA GMAP.LOOKUP+$1
	STA OP2+$1
	JSR IGRE.16					;GMAP.TALLY(2) IGRE GMAP.LOOKUP(2)		
	

.TEMP
		
	BCS .SAVE.INDEX


	INY							;ADVANCE TO NEXT TILE PAIR. X-REG IS THE LO BYTE OF GMAP.INDEX FOR THE DURATION OF THIS LOOP
	INY							;EVEN THOUGH IT'S A 2 BYTE INX, IT WILL ADVANCE FROM !254 TO 0, THUS BNE WILL DETECT THE FLIP. 
	BNE .NO.FLIP
	INC GMAP.ADDRESS.INDEX+$1
	INC GMAP.INDEX.HO			;**OPT** (a counter to help troubleshooting, comment out this line at least. If removed, also remove the definition for GMAP.INDEX.HO and GMAP.INDEX.LO. There are 3 lines like this in the program, two for HO and one for LO. 
.NO.FLIP
		 
		
	JMP .LOOP.LOOKUP	
	
.SAVE.INDEX
		
	JSR SBC.16						;GMAP.TALLY(2) - GMAP.LOOKUP(2)

	
	LDA RESULT	
	CMP #$00						;USING 16-BIT BECAUSE PRIOR SBC.16 CALCULATION SHOULD ALWAYS RESULT IN AN 8-BIT VALUE

	BEQ	.NO.INDEX.OVERFLOW			;OVERFLOW? 
		
		
	LDA RESULT
	STA TEMP						;# OF TILES COMPRESSED AT GMAP.INDEX BEYOND WHAT IS NEEDED FOR GMAP.LOOKUP
	
	LDA (GMAP.ADDRESS.INDEX),Y
	SEC								;**OPT** remove if I'm not going to check for overflow error?
	SBC TEMP
	STA GMAP.INDEX.OVERFLOW			;# OF TILES MORE THAN WHAT SHOULD BE USED IN INDEX POSITION	
			
	JMP .EXIT						;IF INDEX OVERFLOW, EXIT (leave X index as-is so TILE.LOOKUP.ROW can parse out overflow tiles)

.NO.INDEX.OVERFLOW
	
	STA GMAP.INDEX.OVERFLOW			;SET INDEX OVERFLOW TO $00 ($00 SHOULD BE IN ACC ALREADY SINCE BRANCH TO GET HERE WAS BEQ)
	
	INY								;IF NO INDEX OVERFLOW, INCREMENT X INDEX TO NEXT TILE DATA PAIR (tile qty, tile type)
	INY								;ADVANCE TO NEXT TILE PAIR. X-REG IS THE LO BYTE OF GMAP.INDEX FOR THE DURATION OF THIS LOOP. ;EVEN THOUGH IT'S A 2 BYTE INX, IT WILL ADVANCE FROM !254 TO 0, THUS BNE WILL DETECT THE FLIP. 
    BNE .NO.FLIP2
	INC GMAP.ADDRESS.INDEX+$1
	INC GMAP.INDEX.HO			;**OPT** (a counter to help troubleshooting, comment out this line at least. If removed, also remove the definition for GMAP.INDEX.HO and GMAP.INDEX.LO. There are 3 lines like this in the program, two for HO and one for LO. 
.NO.FLIP2
	
	
.EXIT	
	STY GMAP.INDEX.LO					;**OPT** (a counter to help troubleshooting, comment out this line at least. If removed, also remove the definition for GMAP.INDEX.HO and GMAP.INDEX.LO. There are 3 lines like this in the program, two for HO and one for LO. 


	LDA	GMAP.ADDRESS.INDEX	
	STA OP1			
	LDA	GMAP.ADDRESS.INDEX+$1	
	STA OP1+$1							
	
	STY OP2								;Y-REG WAS THE LO BYTE COUNTER OF GMAP.ADDRESS.INDEX. GMAP.ADDRESS.INDEX+$1 (HO) IS INCREMENTED AS Y-REG FLIPS TO $00 DURING THIS ROUTINE. 
	LDA #$00
	STA OP2+$1
	JSR ADC.16							;GMAP.ADDRESS.INDEX (2) + Y-REG (1)
	
	LDA RESULT
	STA GMAP.ADDRESS.INDEX				;THIS WILL BE USED AS THE STARTING POINT FOR ITERATING THROUGH THE GMAP.TILE.DATA ARRAY IN TILES.LOOKUP.ROW FOR COPYING TILES TO THE SCREEN.TILE.ROW ARRAY
	LDA RESULT+$1
	STA GMAP.ADDRESS.INDEX+$1
	
			
	RTS


	
TILE.LOOKUP.ROW 		 ;=============????============
;PARAMETERS
;REQUIREMENTS: MUST BE PRECEDED BY TILE.LOOKUP, BUT THEN CAN BE REPEATED TO OBTAIN ROWS IN SEQUENCE. 

;init counters	
	LDA #$00		
 	STA GMAP.EXPAND.TALLY						
	TAY
	TAX
	
;get a compressed tile type pair
.GET.PAIR	

	
	LDA (GMAP.ADDRESS.INDEX),Y			;# OF TILES
	STA GMAP.INDEX.QUANTITY
	SEC
	SBC GMAP.INDEX.OVERFLOW			;IF THERE WAS AN INDEX OVERFLOW WHEN CALCULATING THE INDEX, SUBTRACT IT FROM THE TILE QTY.
	STA GMAP.INDEX.QUANTITY
			PHA						;push GMAP.INDEX.QUANTITY to the stack
			LDA #$00				;testing this out
			STA GMAP.INDEX.OVERFLOW	
			PLA						;pull GMAP.INDEX.QUANTITY from the stack
	JMP .FIRST.ENTRY.ONLY
	
.GET.PAIR.LOOP
	LDA (GMAP.ADDRESS.INDEX),Y			;LOAD # OF TILES
	STA GMAP.INDEX.QUANTITY
.FIRST.ENTRY.ONLY	
	CLC
	ADC GMAP.EXPAND.TALLY			;KEEP A TALLY OF THE NUMBER OF TILES READ IN FROM THE COMPRESSED DATA. WE DON'T WANT TO COPY TOO MANY TO THE SCREEN.TILE.ROW ARRAY
	STA	GMAP.EXPAND.TALLY
	BCS .ERROR						;Exit to .ERROR if result of ADC is > 255
		
	LDA #SCREEN.ROW.SIZE
	CMP GMAP.EXPAND.TALLY 			;DO WE HAVE MORE THAN A FULL ROW OF TILES THIS CYCLE? (I.E. OVERFLOW)
	BCS .COPY						;IF NO, PROCEED TO COPY TILES TO SCREEN.TILE.ROW 	

	LDA GMAP.EXPAND.TALLY			;IF YES, DECREASE GMAP.INDEX.QUANTITY SO WE ONLY GET A FULL ROW OF TILES
	SEC
	SBC #SCREEN.ROW.SIZE
	STA TEMP
	LDA GMAP.INDEX.QUANTITY	
	SEC								;**OPT** ARE THESE SEC'S REALLY NEEDED IF I'M CONFIDENT THERE WILL BE NO SUBTRACTION UNDERFLOW?
	SBC TEMP
	STA GMAP.INDEX.QUANTITY
	STA GMAP.INDEX.OVERFLOW			;THE # OF TILES FOR THE LAST COPY FOR THIS ROW == THE NUMBER OF TILES TO SKIP IN THIS INDEX POSITION WHEN READING IN THE NEXT ROW
			
			
.COPY
	INY									;TEMPORARILY INCREMENT Y SO WE CAN ACCESS TILE TYPE
	LDA (GMAP.ADDRESS.INDEX),Y			;TILE TYPE
	DEY									;RETURN Y TO ORIGINAL VALUE FOR THIS ITERATION
.COPY.LOOP	
	STA SCREEN.TILE.ROW,X
	INX

.TEMP
	
	DEC GMAP.INDEX.QUANTITY
	BNE .COPY.LOOP
	
	CPX #SCREEN.ROW.SIZE			;HAVE A FULL ROW OF TILES BEEN COPIED?
	BCS .EXIT						;IF YES, EXIT (BCS: is Y-reg >= CPY operand)
	

	INY								;IF NO, ADVANCE TO NEXT TILE PAIR AND REPEAT
	INY
	JMP .GET.PAIR.LOOP
	
.EXIT
		
		
	LDA GMAP.INDEX.OVERFLOW			;IS THERE AN INDEX OVERFLOW IN THE LAST ELEMENT OF THE ARRAY LOADED
	BNE .INDEX.OVERFLOW			;IF YES, EXIT WITH INDEX COUNTER AS-IS SO THE OVERFLOW IS PROCESSED IN NEXT CALL OF THIS ROUTINE 
	INY								;IF NO, INCREMENT INDEX BY TWO TO GET NEXT TILE PAIR IF THIS ROUTINE IS CALLED AGAIN
	INY								
.INDEX.OVERFLOW	
	
	;**OPT** I JUST REMEMBERED THAT THE ARRAY ELEMENTS ARE ONLY SEQUENTIAL HORIZONTALLY, NOT VERTICALLY
	;THUS WE CAN'T CALL THIS ROUTINE OVER AND OVER TO GET THE ROWS OF TILES FOR THE SCREEN. EACH ROW
	;MUST BE OBTAINED VIA A CALL TO TILE.LOOKUP AND THEN TO THIS ROUTINE (TILE.LOOKUP.NEXT, PROBABLY TO
	;BE RENAMED TILE.LOOKUP.ROW IN THE FUTURE). THIS, WE DON'T NEED TO WORRY ABOUT PASSING ON AN OVERFLOW
	;TO THE NEXT ITERATION. THUS, THE CODE CAN PROBABLY JUST HAVE .EXIT AND THEN RTS. 
	
	
	;NOTE: ORIGINAL PLAN FOR UPDATING INDEX SO THIS ROUTINE COULD BE CALLED AGAIN TO GET THE NEXT ROW. 
	;I THINK WHAT IS NEEDED HERE IS A REVERSE OF THE INITIAL CALC FOR BASE ADDRESS
	;ADD THE LO TO THE GMAP.ADDRESS.INDEX AND IF THERE IS AN OVERFLOW, INC GMAP.ADDRESS.INDEX+$1. 
	;THE VALUES SHOULD END UP IN GMAP.INDEX SO THEY CAN GET LOADED IN ON NEXT CALL TO THIS ROUTINE.
	;I CAN PROBABLY ALSO REMOVE THE "STA GMAP.INDEX.OVERFLOW" IN .GET.PAIR.LOOP SINCE WE DON'T CARE
	;ABOUT THE OVERFLOW FOR THE ITERATION. 
	;
	;I DID WRITE SOME 8-BIT CODE TO HANDLE AN OVERLFOW AT THE END, SEE TEST3.4STABLE FOR THAT CODE. 
	RTS
	
.ERROR
	;.GET.PAIR had an ADC overflow
	
	BRK
	
TILE.LOOKUP.SINGLE
	
;<TBD>



;======INCLUDE FILES======

;NONE
	

				
;==========================DEFINE VARIABLES======================

;this array was modified to convert the $0A values to $09 for compatability with the spreadsheet analysis tool. Thus, it's not precicesly a 64x64 array. that could be tweaked in the speadsheet and copied back to the source code if useful to have the production array also match the spreadsheet analysis tool.
;lookup value			       10  	 x	    	 	        +17 (overfllow 2)                 ??+17 (extra 1)
;tile qty				 q	   q	 q     q     q     q     q    q     q      q     q     q     q     q  																																																																																																																																																																												?									         
;GMAP.TILE.DATA 		.HS	05.00.05.01.01.08.05.00.05.00.05.00.01.08.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.03.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.09.00.05.01.02.00.05.02.05.01.03.00
;array elements			00.01.02.03.04.05.06.07.08.09.0A.0B.0C.0D.0E.0F.10.11.12.13.14.15.16.17.18.19.1A.1B.1C.1D.1E.1F.20.21.22.23.24.25.26.27.28.29.2A.2B.2C.2D.2E.2F.30.31.32.33.34.35.36.37.38.39.3A.3B.3C.3D.3E.3F.40.41.42.43.44.45.46.47.48.49.4A.4B.4C.4D.4E.4F.50.51.52.53.54.55.56.57.58.59.5A.5B.5C.5D.5E.5F.60.61.62.63.64.65.66.67.68.69.6A.6B.6C.6D.6E.6F.70.71.72.73.74.75.76.77.78.79.7A.7B.7C.7D.7E.7F.80.81.82.83.84.85.86.87.88.89.8A.8B.8C.8D.8E.8F.90.91.92.93.94.95.96.97.98.99.9A.9B.9C.9D.9E.9F.A0.A1.A2.A3.A4.A5.A6.A7.A8.A9.AA.AB.AC.AD.AE.AF.B0.B1.B2.B3.B4.B5.B6.B7.B8.B9.BA.BB.BC.BD.BE.BF.C0.C1.C2.C3.C4.C5.C6.C7.C8.C9.CA.CB.CC.CD.CE.CF.D0.D1.D2.D3.D4.D5.D6.D7.D8.D9.DA.DB.DC.DD.DE.DF.E0.E1.E2.E3.E4.E5.E6.E7.E8.E9.EA.EB.EC.ED.EE.EF.F0.F1.F2.F3.F4.F5.F6.F7.F8.F9.FA.FB.FC.FD.FE.FF.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01.01
;																																																																																																																																																																																																						00.01.02.03.04.05.06.07.08.09.0A.0B.0C.0D.0E.0F.10.11.12.13.14.15.16.17.18.19.1A.1B.1C.1D.1E.1F.20.21.22.23.24.25.26.27.28.29.2A.2B.2C.   								

;use for testing movement, this is 64x64 tiles. But, before using, use replace to convert the 0A values to 09 so it's compatible with the analyis spreadsheet
;GMAP.TILE.DATA 		.HS	05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00.05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00
;


GMAP.TALLY					.BS	$2						;2byt	(16-BIT)
GMAP.LOOKUP					.BS	$2						;2byt   (16-BIT)

GMAP.INDEX.LO				.BS	$1						;2byt	(16-BIT)
GMAP.INDEX.HO				.BS	$1						;paired with preceding
GMAP.ADDRESS.INDEX			.EQ	$EB						;2byt   (used as a pointer to GMAP.TILE.DATA to accomidate it's >256 byte size)
;

SCREEN.ROW.SIZE				.EQ $11						;#CONSTANT   (!17)

SCREEN.TILE.ROW 			.EQ	$7000			 		;remove absolute reference. $11byts
GMAP.EXPAND.TALLY			.BS	$1		
GMAP.INDEX.OVERFLOW			.BS	$1						;1byt
GMAP.INDEX.QUANTITY			.BS	$1						;1byt
TEMP						.BS $1						;1byt




; RAW DATA FOR 64X64 TILE MAP (1 MAP ROW PER LINE X 64 LINES)
;
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.00.05.01.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.02
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.02.03.01
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.00.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.01.05.02.03.00
;05.00.05.01.05.03.02.00.02.01.05.00.05.00.05.03.0A.00.05.01.02.00.05.02.05.01.03.00